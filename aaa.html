<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown 数据可视化工具</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #1a2a6c);
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 10px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .card-title {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #64FFDA;
            display: flex;
            align-items: center;
        }
        
        .card-title i {
            margin-right: 10px;
            font-size: 1.8rem;
        }
        
        .input-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-box {
            flex: 1;
            min-width: 250px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #64B5F6;
        }
        
        input {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 10px;
            background: rgba(0, 0, 0, 0.2);
            color: white;
            font-size: 1rem;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        input:focus {
            outline: none;
            border-color: #64B5F6;
            box-shadow: 0 0 0 2px rgba(100, 181, 246, 0.3);
            background: rgba(0, 0, 0, 0.3);
        }
        
        button {
            background: linear-gradient(to right, #2193b0, #6dd5ed);
            color: white;
            border: none;
            padding: 14px 30px;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
            background: linear-gradient(to right, #1e7a94, #5bc0de);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
        }
        
        .markmap-container {
            background: rgba(0, 5, 20, 0.7);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            height: 500px;
            margin-top: 20px;
            position: relative;
        }
        
        .markmap {
            width: 100%;
            height: 100%;
        }
        
        .markmap svg {
            width: 100%;
            height: 100%;
        }
        
        .status {
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .status.success {
            color: #76FF03;
            border-left: 4px solid #76FF03;
        }
        
        .status.error {
            color: #FF5252;
            border-left: 4px solid #FF5252;
        }
        
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            color: #64B5F6;
        }
        
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #64B5F6;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        footer {
            text-align: center;
            padding: 30px 0;
            margin-top: 20px;
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        @media (max-width: 768px) {
            .input-group {
                flex-direction: column;
                gap: 15px;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            button {
                width: 100%;
                justify-content: center;
            }
            
            .markmap-container {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="container">
            <header>
                <h1>Markdown 数据可视化工具</h1>
                <p class="subtitle">输入您的凭证获取数据，实时生成可视化图表</p>
            </header>
            
            <main>
                <div class="card">
                    <h2 class="card-title">
                        <span>🔑 身份验证</span>
                    </h2>
                    
                    <div class="input-group">
                        <div class="input-box">
                            <label for="username">用户名</label>
                            <input 
                                type="text" 
                                id="username" 
                                placeholder="请输入用户名" 
                                v-model="username"
                            >
                        </div>
                        
                        <div class="input-box">
                            <label for="password">密码</label>
                            <input 
                                type="password" 
                                id="password" 
                                placeholder="请输入密码" 
                                v-model="password"
                            >
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button @click="fetchData">
                            <span>🚀 获取数据并生成图表</span>
                        </button>
                        <button class="btn-secondary" @click="loadSampleData">
                            <span>✨ 加载示例数据</span>
                        </button>
                    </div>
                    
                    <div class="status" :class="statusClass" v-if="statusMessage">
                        <span v-if="isLoading" class="loading">
                            <span class="spinner"></span>
                        </span>
                        {{ statusMessage }}
                    </div>
                </div>
                
                <div class="card">
                    <h2 class="card-title">
                        <span>📊 数据可视化图表</span>
                    </h2>
                    
                    <div class="markmap-container">
                        <div class="markmap">
                            <script type="text/template">
                                {{ markdownContent }}
                            </script>
                        </div>
                    </div>
                </div>
            </main>
            
            <footer>
                <p>© 2023 数据可视化工具 | 使用 Vue3 和 Markmap 构建</p>
            </footer>
        </div>
    </div>

    <script>
        const { createApp, ref, reactive, onMounted } = Vue;
        
        createApp({
            setup() {
                const username = ref('');
                const password = ref('');
                const markdownContent = ref(`# 等待数据加载...
- 请在上方输入用户名和密码
- 然后点击"获取数据并生成图表"
- 或者使用"加载示例数据"查看示例`);
                
                const statusMessage = ref('');
                const statusClass = ref('');
                const isLoading = ref(false);
                
                // 模拟从API获取数据
                const fetchData = async () => {
                    if (!username.value || !password.value) {
                        statusMessage.value = "错误：请输入用户名和密码";
                        statusClass.value = "error";
                        return;
                    }
                    
                    isLoading.value = true;
                    statusMessage.value = "正在连接服务器并获取数据...";
                    statusClass.value = "";
                    
                    try {
                        // 模拟API请求延迟
                        await new Promise(resolve => setTimeout(resolve, 1500));
                        
                        // 模拟成功响应
                        const mockResponse = {
                            data: `# 数据获取成功！
- **用户名**: ${username.value}
- **时间**: ${new Date().toLocaleTimeString()}\n- **数据源**: 安全API

## 数据分析结果
- 用户行为分析
  - 登录次数: 42
  - 平均会话时间: 12分钟
- 系统性能
  - 响应时间: 128ms
  - 正常运行率: 99.8%

## 关键指标
- 活跃用户数: 1,240
- 数据吞吐量: 2.4GB/s
- 错误率: 0.12%`
                        };
                        
                        markdownContent.value = mockResponse.data;
                        statusMessage.value = "数据获取成功！图表已更新";
                        statusClass.value = "success";
                    } catch (error) {
                        statusMessage.value = `错误：${error.message || "无法获取数据"}`;
                        statusClass.value = "error";
                    } finally {
                        isLoading.value = false;
                        
                        // 重新渲染markmap
                        setTimeout(renderMarkmap, 100);
                    }
                };
                
                // 加载示例数据
                const loadSampleData = () => {
                    username.value = "demo_user";
                    password.value = "••••••••";
                    const url = 'https://packages.aliyun.com/api/protocol/664ae465dba1fd117e808412/generic/dockerimage/files/requirements/requirements.txt?version=1.2.6';
                    axios({
                    method: 'get',
                    url: url,
                    responseType: 'stream', // 设置响应类型为流
                    auth: {
                        username: username.value,
                        password: password.value,
                    },
                    })
                    .then(response => {
                        console.log(response.data);
                        // 创建写入流，将文件保存到本地
                        const writer = fs.createWriteStream(outputPath);
                        response.data.pipe(writer);

                        return new Promise((resolve, reject) => {
                        writer.on('finish', resolve);
                        writer.on('error', reject);
                        });
                    })
                    .then(() => {
                        console.log('文件下载成功:', outputPath);
                    })
                    .catch(error => {
                        console.error('下载失败:', error.message);
                    });
//                     markdownContent.value = `# 示例数据：项目分析
                    
// ## 项目状态
// - 完成度: 75%
// - 预算使用: 62%
// - 时间线: 按计划

// ### 团队构成
// - 开发人员: 8
// - 设计师: 2
// - 产品经理: 1
// - QA工程师: 2

// ## 关键里程碑
// - 需求分析 (已完成)
// - 系统设计 (已完成)
// - 核心开发
//   - 后端API (95%)
//   - 前端界面 (70%)
//   - 数据库设计 (100%)
// - 测试阶段
// - 产品发布

// ## 风险分析
// - 技术风险: 低
// - 时间风险: 中
//   - 前端开发延迟
//   - 第三方集成问题
// - 预算风险: 低`;

                    // statusMessage.value = "示例数据加载成功！";
                    // statusClass.value = "success";
                    
                    // // 重新渲染markmap
                    // setTimeout(renderMarkmap, 100);
                };
                
                onMounted(() => {
                    // 初始渲染
                    renderMarkmap();
                });
                
                return {
                    username,
                    password,
                    markdownContent,
                    statusMessage,
                    statusClass,
                    isLoading,
                    fetchData,
                    loadSampleData
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
